aal "dbus_first_test" {
    language "python" {
        from test_mrp_dbus import *
    }

    # preview-hide-vars:
    # preview-depth: 5
    variables {
        set_created, \
        set_acquired, \
        set_updating
    }

    initial_state {
        set_created = False
        set_acquired = False
        set_updating = False
    }

    input "create_set" {
        guard { return not set_created }
        body { set_created = True }
        adapter {
            connect()
            create_res_set()
            add_resource()
        }
    }

    tag "set available" {
        guard { return set_created }

        input "acquire set" {
            body {
                set_acquired = True
                set_updating = True
            }
            adapter {
                acquire_set()
            }
        }

        input "release set" {
            body {
                set_acquired = False
                set_updating = True
            }
            adapter {
                release_set()
            }
        }

        input "disconnect" {
            body {
                set_acquired = False
                set_created = False
                set_updating = False
            }
            adapter {
                disconnect()
            }
        }
    }
}
